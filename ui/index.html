<!DOCTYPE html>
<html lang="en">
<head>    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Player</title>
    <link rel="stylesheet" href="css/captions.css">
    <script src="js/hls.js"></script>
    <link rel="stylesheet" href="css/modernization.css">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #101010;
            color: #ffffff;
            display: flex;
            flex-direction: column;
        }
        
        .app-container {
            display: flex;
            flex: 1;
            height: calc(100% - 40px);
        }
        
        /* Channel Navigator Styles */
        .channel-navigator {
            width: 300px;
            border-right: 1px solid #252525;
            background-color: #151515;
            overflow-y: auto;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .channel-search {
            padding: 10px;
            border-bottom: 1px solid #252525;
            position: sticky;
            top: 0;
            background-color: #151515;
            z-index: 10;
        }
        
        .search-input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #333;
            background-color: #252525;
            color: #fff;
            font-size: 14px;
        }
        
        .channel-groups {
            overflow-y: auto;
            flex: 1;
        }
        
        .group-header {
            padding: 8px 12px;
            font-size: 14px;
            font-weight: bold;
            background-color: #202020;
            cursor: pointer;
            -webkit-user-select: none;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .group-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .group-content.open {
            max-height: 1000px;
        }
        
        .channel-item {
            padding: 8px 12px 8px 24px;
            font-size: 14px;
            cursor: pointer;
            border-bottom: 1px solid #1a1a1a;
            display: flex;
            align-items: center;
        }
        
        .channel-item:hover {
            background-color: #202020;
        }
        
        .channel-logo {
            width: 32px;
            height: 32px;
            margin-right: 10px;
            object-fit: contain;
            background-color: #252525;
            border-radius: 4px;
        }
        
        .channel-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Player Styles */
        .player-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .video-container {
            flex: 1;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        #video-player {
            max-width: 100%;
            max-height: 100%;
            width: 100%;
            height: 100%;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.7) 100%);
            opacity: 0;
            transition: opacity 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 20px;
        }
        
        /* Caption container styles */        /* Caption styles moved to captions.css */
        #caption-container {
            display: none;
        }
        
        .video-container:hover .video-overlay {
            opacity: 1;
        }
        
        .channel-info {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .channel-info-logo {
            width: 48px;
            height: 48px;
            margin-right: 15px;
            border-radius: 6px;
            object-fit: contain;
            background-color: #252525;
        }
        
        .channel-info-details {
            flex: 1;
        }
        
        .channel-info-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .channel-info-group {
            font-size: 14px;
            color: #aaa;
        }
        
        .progress-bar {
            height: 6px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            margin-bottom: 15px;
            cursor: pointer;
            position: relative;
        }
        
        .progress-bar-filled {
            height: 100%;
            background-color: #0078d7;
            border-radius: 3px;
            width: 0%;
        }
        
        .controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .left-controls, .right-controls {
            display: flex;
            align-items: center;
        }
        
        .control-button {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .play-button {
            font-size: 24px;
        }
          .time-display {
            font-size: 14px;
            color: #ccc;
            margin-right: 15px;
        }
        
        .time-shift-status {
            font-size: 14px;
            color: #ff9900;
            margin-right: 15px;
            padding: 4px 8px;
            border-radius: 4px;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
        }
        
        .time-shift-status.active {
            display: inline-block;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        .volume-container {
            display: flex;
            align-items: center;
        }
        
        .volume-slider {
            width: 80px;
            margin-left: 10px;
        }
          .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Time-shift indicator */
        .time-shift-status {
            font-size: 12px;
            color: #2196F3;
            margin-left: 15px;
            display: flex;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .time-shift-active {
            opacity: 1;
        }
        
        .time-shift-icon {
            margin-right: 5px;
        }
        
        /* Status bar */
        .status-bar {
            height: 24px;
            background-color: #1a1a1a;
            border-top: 1px solid #252525;
            display: flex;
            align-items: center;
            padding: 0 10px;
            font-size: 12px;
            color: #888;
        }
        
        .status-item {
            margin-right: 15px;
        }
        
        .status-recording {
            color: #ff4444;
        }
        
        /* Fullscreen styles */
        .fullscreen .channel-navigator {
            display: none;
        }
        
        .fullscreen .player-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            background-color: #000;
        }
        
        .fullscreen .status-bar {
            display: none;
        }
          /* EPG Styles */
        .epg-panel {
            position: absolute;
            bottom: 60px;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.85);
            border-top: 1px solid #333;
            height: 0;
            overflow: hidden;
            transition: height 0.3s ease;
            z-index: 5;
        }
        
        .epg-panel.visible {
            height: 250px;
        }
        
        .epg-header {
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #333;
        }
        
        .epg-title {
            font-size: 16px;
            font-weight: bold;
        }
        
        .epg-close {
            cursor: pointer;
            font-size: 18px;
            color: #888;
        }
        
        .epg-close:hover {
            color: #fff;
        }
        
        .epg-content {
            display: flex;
            height: calc(100% - 40px);
            overflow: hidden;
        }
        
        .epg-timeline {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow-y: auto;
            width: 100%;
        }
        
        .epg-program {
            padding: 10px 15px;
            border-bottom: 1px solid #252525;
            cursor: pointer;
        }
        
        .epg-program:hover {
            background-color: #252525;
        }
        
        .epg-program.current {
            background-color: rgba(0, 120, 215, 0.2);
            border-left: 4px solid #0078d7;
        }
        
        .epg-time {
            font-size: 12px;
            color: #888;
            margin-bottom: 4px;
        }
        
        .epg-program-title {
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .epg-description {
            font-size: 13px;
            color: #aaa;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Metadata Overlay */
        .metadata-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 4px;
            padding: 8px 12px;
            color: #fff;
            font-size: 13px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 4;
            max-width: 300px;
        }
        
        .video-container:hover .metadata-overlay {
            opacity: 1;
        }
        
        .metadata-item {
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        .metadata-label {
            font-weight: bold;
            margin-right: 10px;
            color: #aaa;
        }
        
        .metadata-value {
            color: #fff;
            text-align: right;
        }
        
        /* Enhanced Search */
        .channel-search {
            padding: 10px;
            border-bottom: 1px solid #252525;
            position: sticky;
            top: 0;
            background-color: #151515;
            z-index: 10;
        }
        
        .search-container {
            position: relative;
            margin-bottom: 8px;
        }
        
        .search-input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #333;
            background-color: #252525;
            color: #fff;
            font-size: 14px;
        }
        
        .search-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
        }
        
        .search-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        
        .filter-tag {
            background-color: #252525;
            border-radius: 12px;
            padding: 4px 10px;
            font-size: 12px;
            cursor: pointer;
            border: 1px solid #333;
        }
        
        .filter-tag.active {
            background-color: #0078d7;
            border-color: #0078d7;
        }
        
        .search-results {
            max-height: 300px;
            overflow-y: auto;
            background-color: #202020;
            border: 1px solid #333;
            border-radius: 4px;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 11;
            display: none;
        }
        
        .search-results.visible {
            display: block;
        }
        
        .search-result-item {
            padding: 8px 12px;
            border-bottom: 1px solid #252525;
            cursor: pointer;
        }
        
        .search-result-item:hover {
            background-color: #252525;
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        .search-result-title {
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .search-result-info {
            font-size: 12px;
            color: #888;
        }
        
        /* Loading animation */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Error overlay */
        .error-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            display: none;
        }
        
        .error-icon {
            font-size: 48px;
            color: #ff4444;
            margin-bottom: 20px;
        }
        
        .error-message {
            font-size: 18px;
            text-align: center;
            max-width: 80%;
            margin-bottom: 20px;
        }
        
        .error-retry {
            padding: 8px 16px;
            background-color: #0078d7;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
        }
        
        /* Recommendations Panel */
        .recommendations-container {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            border-left: 1px solid #333;
            z-index: 200;
            display: none;
            flex-direction: column;
        }
        
        .recommendations-header {
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }
        
        .recommendations-header h3 {
            font-size: 16px;
            margin: 0;
        }
        
        .recommendations-close {
            background: none;
            border: none;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
        }
        
        .recommendations-close:hover {
            color: #0078d7;
        }
        
        .recommendations-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .recommendation-item {
            background-color: #202020;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .recommendation-item:hover {
            background-color: #252525;
        }
        
        .recommendation-title {
            font-size: 14px;
            font-weight: bold;
            margin: 0 0 5px 0;
        }
        
        .recommendation-description {
            font-size: 12px;
            color: #ccc;
            margin: 0;
        }
        
        /* Casting Panel */
        .casting-container {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            border-left: 1px solid #333;
            z-index: 200;
            display: none;
            flex-direction: column;
        }
        
        .casting-header {
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }
        
        .casting-header h3 {
            font-size: 16px;
            margin: 0;
        }
        
        .casting-close {
            background: none;
            border: none;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
        }
        
        .casting-close:hover {
            color: #0078d7;
        }
        
        .casting-status {
            padding: 10px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .casting-not-active {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .casting-active {
            display: none;
            flex-direction: column;
            align-items: center;
        }
        
        .device-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .device-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .device-list-header h4 {
            font-size: 14px;
            margin: 0;
        }
        
        .refresh-devices-button {
            background: none;
            border: none;
            color: #0078d7;
            cursor: pointer;
            font-size: 14px;
        }
        
        .refresh-devices-button:hover {
            text-decoration: underline;
        }
        
        .device-list {
            background-color: #151515;
            border-radius: 4px;
            padding: 10px;
        }
        
        .device-item {
            padding: 8px 12px;
            border-bottom: 1px solid #252525;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .device-item:last-child {
            border-bottom: none;
        }
        
        .device-name {
            font-size: 14px;
            color: #fff;
        }
        
        .device-status {
            font-size: 12px;
            color: #aaa;
        }
        
        .casting-controls {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        
        .casting-control-button {
            background: #0078d7;
            border: none;
            color: #fff;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .casting-control-button:hover {
            background: #0056a1;
        }
        
        /* General button styles */
        .control-button {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Hide elements initially */
        #recommendations-panel,
        #casting-panel {
            display: none;
        }
        
        /* Status message container */
        .status-message-container {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 10px 15px;
            border-radius: 4px;
            z-index: 300;
            display: none;
            font-size: 14px;
            max-width: 300px;
            width: 100%;
        }
        
        /* Help panel for modernization features */
        .modernization-help-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            border: 1px solid #333;
            z-index: 400;
            display: none;
            flex-direction: column;
        }
        
        .help-header {
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }
        
        .help-header h3 {
            font-size: 16px;
            margin: 0;
            color: #fff;
        }
        
        .help-close {
            background: none;
            border: none;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
        }
        
        .help-close:hover {
            color: #0078d7;
        }
        
        .help-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            color: #fff;
        }
        
        .help-section {
            margin-bottom: 15px;
        }
        
        .help-section h4 {
            font-size: 14px;
            margin: 0 0 10px 0;
            color: #0078d7;
        }
        
        .help-icon {
            font-size: 16px;
            vertical-align: middle;
            margin-left: 5px;
        }
        
        .help-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #333;
            padding-top: 10px;
        }
        
        .help-button {
            padding: 8px 12px;
            background-color: #0078d7;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
        }
        
        .help-button:hover {
            background-color: #0056a1;
        }
        
        /* Animation for help panel */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-10px);
            }
        }
        
        /* Message styles */
        .message {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .message.visible {
            opacity: 1;
        }
        
        .message-info {
            background-color: rgba(0, 123, 255, 0.1);
            color: #007bff;
        }
        
        .message-success {
            background-color: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }
        
        .message-warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }
        
        .message-error {
            background-color: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        
        .message-close {
            margin-left: 10px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="app-container">        <!-- Channel Navigator -->
        <div class="channel-navigator">
            <div class="channel-search">
                <div class="search-container">
                    <input type="text" class="search-input" id="search-input" placeholder="Search channels...">
                    <span class="search-icon">🔍</span>
                </div>
                <div class="search-filters">
                    <div class="filter-tag" data-filter="all">All</div>
                    <div class="filter-tag" data-filter="favorites">Favorites</div>
                    <div class="filter-tag" data-filter="recent">Recently Watched</div>
                </div>
                <div class="search-results" id="search-results">
                    <!-- Search results will be populated here -->
                </div>
            </div>
            <div class="channel-groups" id="channel-groups">
                <!-- Channel groups will be populated here -->
                <div class="loading-channels">Loading channels...</div>
            </div>
        </div>
        
        <!-- Player Section -->
        <div class="player-container">
            <div class="video-container">
                <video id="video-player"></video>
                <div id="caption-container" style="display: none;"></div>
                
                <div class="video-overlay">                    <div class="channel-info">
                        <img class="channel-info-logo" id="channel-logo" src="../assets/icon.png" alt="Channel logo">
                        <div class="channel-info-details">
                            <div class="channel-info-name" id="channel-name">No Channel Selected</div>
                            <div class="channel-info-group" id="channel-group"></div>
                        </div>
                    </div>
                    
                    <div class="controls">
                        <div class="left-controls">
                            <button class="control-button" id="rewind-btn" title="Rewind 10 seconds">⏪</button>
                            <button class="control-button play-button" id="play-pause-btn">⏵</button>
                            <button class="control-button" id="forward-btn" title="Forward 10 seconds">⏩</button>
                            <button class="control-button" id="stop-btn">⏹</button>
                            <div class="time-display" id="time-display">00:00:00</div>
                            <div class="time-shift-status" id="time-shift-status"></div>
                        </div>
                        <div class="right-controls">
                            <button class="control-button" id="record-btn">⚫</button>
                            <button class="control-button" id="schedule-btn" title="Schedule Recording">📅</button>
                            <button class="control-button" id="cast-btn" title="Cast to Device">📱</button>
                            <div class="volume-container">
                                <button class="control-button" id="mute-btn">🔊</button>
                                <label for="volume-slider" class="sr-only">Volume</label>
                                <input type="range" min="0" max="100" value="100" class="volume-slider" id="volume-slider" title="Volume Control">
                            </div>
                            <button class="control-button" id="caption-btn" title="Toggle Closed Captions">CC</button>
                            <button class="control-button" id="fullscreen-btn">⛶</button>
                        </div>
                    </div>                </div>
                
                <!-- Metadata Overlay -->
                <div class="metadata-overlay" id="metadata-overlay">
                    <div class="metadata-item">
                        <span class="metadata-label">Title:</span>
                        <span class="metadata-value" id="metadata-title">Unknown</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label">Quality:</span>
                        <span class="metadata-value" id="metadata-quality">Unknown</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label">Bitrate:</span>
                        <span class="metadata-value" id="metadata-bitrate">Unknown</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label">Codec:</span>
                        <span class="metadata-value" id="metadata-codec">Unknown</span>
                    </div>
                </div>
                
                <!-- EPG Panel -->
                <div class="epg-panel" id="epg-panel">
                    <div class="epg-header">
                        <div class="epg-title">Program Guide</div>
                        <div class="epg-close" id="epg-close">×</div>
                    </div>
                    <div class="epg-content">
                        <div class="epg-timeline" id="epg-timeline">
                            <div class="epg-loading" id="epg-loading">
                                <div class="loading-spinner"></div>
                                Loading program guide...
                            </div>
                            <!-- Program items will be populated here -->
                        </div>
                    </div>
                </div>
                
                <!-- Error Overlay -->
                <div class="error-overlay" id="error-overlay">
                    <div class="error-icon">⚠️</div>
                    <div class="error-message" id="error-message">
                        Unable to play this stream. The stream may be offline or not available in your region.
                    </div>
                    <button class="error-retry" id="error-retry">Try Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-item" id="status-channel">No channel selected</div>
        <div class="status-item" id="status-quality"></div>
        <div class="status-item status-recording" id="status-recording" style="display: none;">● REC</div>
    </div>
    
    <!-- Recommendations Panel -->
    <div class="recommendations-container" id="recommendations-panel">
        <div class="recommendations-header">
            <h3>Recommended For You</h3>
            <button class="recommendations-close" id="recommendations-close">&times;</button>
        </div>
        <div class="recommendations-content" id="recommendations-content">
            <!-- Recommendations will be populated here dynamically -->
            <div class="recommendations-empty">Loading recommendations...</div>
        </div>
    </div>

    <!-- Casting Panel -->
    <div class="casting-container" id="casting-panel">
        <div class="casting-header">
            <h3>Cast to Device</h3>
            <button class="casting-close" id="casting-close">&times;</button>
        </div>
        <div class="casting-status" id="casting-status">
            <div class="casting-not-active" id="casting-not-active">
                <p>Select a device to start casting:</p>
            </div>
            <div class="casting-active" id="casting-active">
                <p>Currently casting to: <span id="active-device-name">Unknown</span></p>
                <div class="casting-controls">
                    <button id="casting-play-pause" class="casting-control-button">⏯</button>
                    <button id="casting-stop" class="casting-control-button">⏹</button>
                </div>
            </div>
        </div>
        <div class="device-list-container">
            <div class="device-list-header">
                <h4>Available Devices</h4>
                <button id="refresh-devices" class="refresh-devices-button" title="Refresh Devices">🔄</button>
            </div>
            <div id="device-list" class="device-list">
                <!-- Casting devices will be populated here dynamically -->
                <div class="no-devices-found">Searching for devices...</div>
            </div>
        </div>
    </div>

    <!-- Help panel for modernization features -->
    <div class="modernization-help-panel" id="modernization-help">
        <div class="help-header">
            <h3>New Features Available!</h3>
            <button class="help-close" id="help-close">&times;</button>
        </div>
        <div class="help-content">
            <div class="help-section">
                <h4>📱 Casting</h4>
                <p>Stream content to your Chromecast or DLNA devices.</p>
                <ol>
                    <li>Click the cast button <span class="help-icon">📱</span> in the player controls</li>
                    <li>Select a device from the list</li>
                    <li>Control playback from the casting panel</li>
                </ol>
            </div>
            <div class="help-section">
                <h4>👁️ Recommendations</h4>
                <p>Get personalized channel recommendations based on your viewing history.</p>
                <ol>
                    <li>Click the recommendations button <span class="help-icon">👁️</span></li>
                    <li>View and select from your recommended channels</li>
                    <li>Watch more to improve your recommendations</li>
                </ol>
            </div>
            <div class="help-footer">
                <label>
                    <input type="checkbox" id="dont-show-again"> Don't show this again
                </label>
                <button id="help-got-it" class="help-button">Got it!</button>
            </div>
        </div>
    </div>

    <!-- Toggle Buttons for Recommendations -->
    <button class="recommendations-toggle" id="recommendations-toggle" title="Show Recommendations">👁️</button>

    <!-- Status message container for notifications -->
    <div id="status-message" class="status-message-container"></div>

    <script src="js/ui-modernization.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for the API to be ready
            document.addEventListener('DOMContentLoaded', async () => {
                try {
                    // DOM Elements
                    const channelGroupsContainer = document.getElementById('channel-groups');
                    const videoPlayer = document.getElementById('video-player');
                    const playPauseBtn = document.getElementById('play-pause-btn');
                    const stopBtn = document.getElementById('stop-btn');
                    const recordBtn = document.getElementById('record-btn');
                    const muteBtn = document.getElementById('mute-btn');
                    const captionBtn = document.getElementById('caption-btn');
                    const volumeSlider = document.getElementById('volume-slider');
                    const fullscreenBtn = document.getElementById('fullscreen-btn');
                    const progressBar = document.getElementById('progress-bar');
                    const progressFilled = document.getElementById('progress-filled');
                    const timeDisplay = document.getElementById('time-display');
                    const channelLogo = document.getElementById('channel-logo');
                    const channelName = document.getElementById('channel-name');
                    const channelGroup = document.getElementById('channel-group');                const statusChannel = document.getElementById('status-channel');
                    const statusQuality = document.getElementById('status-quality');
                    const statusRecording = document.getElementById('status-recording');
                    const errorOverlay = document.getElementById('error-overlay');
                    const errorMessage = document.getElementById('error-message');
                    const errorRetry = document.getElementById('error-retry');
                    const searchInput = document.getElementById('search-input');
                    const searchResults = document.getElementById('search-results');
                    const filterTags = document.querySelectorAll('.filter-tag');
                    const metadataOverlay = document.getElementById('metadata-overlay');
                    const metadataTitle = document.getElementById('metadata-title');
                    const metadataQuality = document.getElementById('metadata-quality');
                    const metadataBitrate = document.getElementById('metadata-bitrate');
                    const metadataCodec = document.getElementById('metadata-codec');
                    const epgPanel = document.getElementById('epg-panel');
                    const epgClose = document.getElementById('epg-close');
                    const epgTimeline = document.getElementById('epg-timeline');
                    const epgLoading = document.getElementById('epg-loading');
                    const timeShiftStatus = document.getElementById('time-shift-status');
                    
                    // State
                    let currentChannel = null;
                    let isPlaying = false;
                    let isRecording = false;
                    let isMuted = false;
                    let allChannels = [];
                    let channelsByGroup = {};
                    let playbackInterval = null;
                    let playbackTime = 0;
                    let metadataUpdateInterval = null;
                    let currentProgram = null;
                    let epgVisible = false;
                    let activeFilter = 'all';
                    let recentChannels = [];
                    let favoriteChannels = [];
                    
                    // Initialize HLS.js
                    // This will be dynamically loaded or provided by preload.js in Electron
                    let hls = null;
                    
                    // Functions
                    function formatTime(seconds) {
                        const h = Math.floor(seconds / 3600);
                        const m = Math.floor((seconds % 3600) / 60);
                        const s = Math.floor(seconds % 60);
                        return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
                    }
                    
                    // Caption handling functions
                    let captionUpdateInterval = null;
                    let currentCaptions = null;
                    
                    function loadCaptionsForChannel(channelId, streamUrl) {
                        // Clear any existing captions
                        clearCaptions();
                        
                        // Call the API to load captions for this channel
                        window.api.loadCaptions(channelId, streamUrl)
                            .then(result => {
                                if (result && result.success) {
                                    console.log('Captions loaded successfully');
                                    currentCaptions = result.captions;
                                    
                                    // Start monitoring video time to display captions
                                    startCaptionMonitoring();
                                }
                            })
                            .catch(error => {
                                console.error('Error loading captions:', error);
                            });
                    }
                      async function startCaptionMonitoring() {
                    // Clear any existing interval
                    if (captionUpdateInterval) {
                        clearInterval(captionUpdateInterval);
                    }
                    
                    const captionContainer = document.getElementById('caption-container');
                    
                    // Get caption settings to apply correct styles
                    let captionSettings;
                    try {
                        captionSettings = await window.api.getCaptionSettings();
                    } catch (error) {
                        console.error('Error getting caption settings:', error);
                        captionSettings = {
                            size: 'medium',
                            position: 'bottom',
                            font: 'sans-serif',
                            color: '#FFFFFF',
                            backgroundColor: 'rgba(0, 0, 0, 0.75)',
                            aiEnhancement: {
                                enabled: false,
                                mode: 'standard'
                            }
                        };
                    }
                      // Remove any existing styling
                    captionContainer.removeAttribute('style');
                    
                    // Apply classes for proper styling using the CSS
                    captionContainer.className = 'caption-container';
                    captionContainer.classList.add(`caption-size-${captionSettings.size}`);
                    captionContainer.classList.add(`caption-position-${captionSettings.position}`);
                    captionContainer.classList.add(`caption-font-${captionSettings.font}`);
                    
                    // Set the color and background color using CSS variables
                    captionContainer.style.setProperty('--caption-color', captionSettings.color);
                    captionContainer.style.setProperty('--caption-background-color', captionSettings.backgroundColor);
                    
                    // Check for captions every 200ms
                    captionUpdateInterval = setInterval(async () => {
                        if (!videoPlayer || !currentCaptions || currentCaptions.length === 0) {
                            return;
                        }
                        
                        // Get current video time in milliseconds
                        const currentTimeMs = videoPlayer.currentTime * 1000;
                        
                        // Find caption for this time
                        let captionText = null;
                        let currentCaption = null;
                        for (const caption of currentCaptions) {
                            if (currentTimeMs >= caption.start && currentTimeMs <= caption.end) {
                                captionText = caption.text;
                                currentCaption = caption;
                                break;
                            }
                        }
                        
                        // Display caption
                        if (captionText) {
                            // If AI enhancement is enabled, use it
                            if (captionSettings.aiEnhancement && captionSettings.aiEnhancement.enabled) {
                                // Cache key for this caption and mode
                                const cacheKey = `${currentCaption.id}-${captionSettings.aiEnhancement.mode}`;
                                
                                // Check if we already have an enhanced version of this caption
                                if (currentCaption.enhancedText && currentCaption.enhancedText[captionSettings.aiEnhancement.mode]) {
                                    captionText = currentCaption.enhancedText[captionSettings.aiEnhancement.mode];
                                } else {
                                    try {
                                        // Enhance the caption with AI
                                        const result = await window.api.enhanceCaptionWithAI(captionText, captionSettings.aiEnhancement.mode);
                                        if (result && result.success) {
                                            captionText = result.text;
                                            
                                            // Cache the enhanced text in the caption object
                                            if (!currentCaption.enhancedText) {
                                                currentCaption.enhancedText = {};
                                            }
                                            currentCaption.enhancedText[captionSettings.aiEnhancement.mode] = captionText;
                                        }
                                    } catch (error) {
                                        console.error('Error enhancing caption:', error);
                                    }
                                }
                                
                                // Add the AI mode class for styling
                                captionContainer.classList.add(`caption-ai-${captionSettings.aiEnhancement.mode}`);
                            } else {
                                // Remove any AI mode classes
                                captionContainer.classList.remove('caption-ai-standard', 'caption-ai-simplified', 'caption-ai-academic', 'caption-ai-casual');
                            }
                            
                            captionContainer.textContent = captionText;
                            captionContainer.style.display = 'block';
                            
                            // Add animation class
                            if (!captionContainer.classList.contains('caption-fade-in')) {
                                captionContainer.classList.add('caption-fade-in');
                                setTimeout(() => {
                                    captionContainer.classList.remove('caption-fade-in');
                                }, 300);
                            }
                        } else {
                            captionContainer.classList.add('caption-fade-out');
                            setTimeout(() => {
                                captionContainer.textContent = '';
                                captionContainer.style.display = 'none';
                                captionContainer.classList.remove('caption-fade-out');
                            }, 300);
                        }
                    }, 200);
                }
                
                function clearCaptions() {
                    if (captionUpdateInterval) {
                        clearInterval(captionUpdateInterval);
                        captionUpdateInterval = null;
                    }
                    
                    const captionContainer = document.getElementById('caption-container');
                    captionContainer.textContent = '';
                    captionContainer.style.display = 'none';
                    currentCaptions = null;
                }
                  function toggleCaptions() {
                    window.api.toggleCaptions()
                        .then(result => {
                            const captionContainer = document.getElementById('caption-container');
                            const captionBtn = document.getElementById('caption-btn');
                            
                            if (result.enabled) {
                                // Update caption button style
                                captionBtn.style.color = '#0078d7';
                                
                                // If we have a current channel, reload captions
                                if (currentChannel) {
                                    loadCaptionsForChannel(currentChannel.id, currentChannel.url);
                                }
                            } else {
                                // Update caption button style
                                captionBtn.style.color = '';
                                
                                // Hide captions
                                captionContainer.style.display = 'none';
                            }
                        })
                        .catch(error => {
                            console.error('Error toggling captions:', error);
                        });
                }
                
                function updatePlaybackTime() {
                    playbackTime += 1;
                    timeDisplay.textContent = formatTime(playbackTime);
                    progressFilled.style.width = `${(videoPlayer.currentTime / videoPlayer.duration) * 100}%`;
                }
                  function playChannel(channel) {
                    if (!channel) return;
                    
                    currentChannel = channel;
                    errorOverlay.style.display = 'none';
                    
                    // Update UI
                    channelName.textContent = channel.title;
                    channelGroup.textContent = channel.group;
                    statusChannel.textContent = channel.title;
                    
                    if (channel.logo) {
                        channelLogo.src = channel.logo;
                        channelLogo.style.display = 'block';
                    } else {
                        channelLogo.style.display = 'none';
                    }
                    
                    // Add to recent channels
                    addToRecentChannels(channel.id);
                    
                    // Dispatch channel-played event for other components
                    document.dispatchEvent(new CustomEvent('channel-played', { 
                        detail: { channel: channel }
                    }));
                    
                    // Play the channel
                    try {
                        window.api.playChannel(channel.id)
                            .then(result => {
                                // Set up video player with HLS.js
                                if (Hls.isSupported()) {
                                    if (hls) {
                                        hls.destroy();
                                    }
                                    
                                    hls = new Hls({
                                        debug: false,
                                        // Enable metadata extraction to get bitrate info
                                        enableStreamingMode: true,
                                    });
                                    
                                    hls.loadSource(result.streamUrl);
                                    hls.attachMedia(videoPlayer);
                                    
                                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                                        videoPlayer.play()
                                            .then(() => {
                                                isPlaying = true;
                                                playPauseBtn.textContent = '⏸';
                                                
                                                // Reset playback time
                                                playbackTime = 0;
                                                clearInterval(playbackInterval);
                                                playbackInterval = setInterval(updatePlaybackTime, 1000);
                                                
                                                // Update status quality
                                                const level = hls.levels[hls.currentLevel];
                                                if (level) {
                                                    statusQuality.textContent = `${level.width}x${level.height}`;
                                                }
                                                
                                                // Setup metadata updater
                                                setupMetadataUpdater();
                                                
                                                // Try to load captions for this channel
                                                loadCaptionsForChannel(channel.id, result.streamUrl);
                                            })
                                            .catch(error => {
                                                console.error('Error playing video:', error);
                                                showError('Failed to play video. Click "Try Again" to retry.');
                                            });
                                    });
                                    
                                    hls.on(Hls.Events.ERROR, (event, data) => {
                                        if (data.fatal) {
                                            console.error('HLS.js fatal error:', data);
                                            showError('Stream error. The channel may be offline.');
                                        }
                                    });
                                    
                                    // Load metadata when media is loaded
                                    hls.on(Hls.Events.LEVEL_LOADED, (event, data) => {
                                        // Extract quality and bitrate info
                                        if (data && data.details) {
                                            const level = hls.levels[hls.currentLevel];
                                            if (level) {
                                                metadataQuality.textContent = `${level.width}x${level.height}`;
                                                statusQuality.textContent = `${level.width}x${level.height}`;
                                                metadataBitrate.textContent = `${Math.round(level.bitrate / 1024)} Kbps`;
                                            }
                                        }
                                    });
                                } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                                    // For Safari that has native HLS support
                                    videoPlayer.src = result.streamUrl;
                                    videoPlayer.addEventListener('loadedmetadata', () => {
                                        videoPlayer.play();
                                        isPlaying = true;
                                        playPauseBtn.textContent = '⏸';
                                        
                                        // Reset playback time
                                        playbackTime = 0;
                                        clearInterval(playbackInterval);
                                        playbackInterval = setInterval(updatePlaybackTime, 1000);
                                        
                                        // Setup metadata updater
                                        setupMetadataUpdater();
                                    });
                                } else {
                                    showError('HLS playback is not supported in your browser.');
                                }
                            })
                            .catch(error => {
                                console.error('Error playing channel:', error);
                                showError(`Error playing channel: ${error.message}`);
                            });
                            
                        // Try to load EPG data for the channel
                        if (channel.epgId) {
                            window.api.getCurrentProgram(channel.epgId)
                                .then(program => {
                                    currentProgram = program;
                                })
                                .catch(error => {
                                    console.error('Error getting current program:', error);
                                });
                        }
                    } catch (error) {
                        console.error('Error setting up channel playback:', error);
                        showError('Failed to play channel');
                    }
                }
                
                function showError(message) {
                    errorOverlay.style.display = 'flex';
                    errorMessage.textContent = message;
                    
                    // Stop playback
                    isPlaying = false;
                    playPauseBtn.textContent = '⏵';
                    clearInterval(playbackInterval);
                    
                    if (hls) {
                        hls.destroy();
                        hls = null;
                    }
                    
                    videoPlayer.pause();
                }
                
                function togglePlay() {
                    if (!currentChannel) return;
                    
                    if (isPlaying) {
                        videoPlayer.pause();
                        isPlaying = false;
                        playPauseBtn.textContent = '⏵';
                        clearInterval(playbackInterval);
                        
                        // If time-shifting is supported, we need to pause properly
                        window.api.pausePlayback().catch(error => {
                            console.error('Failed to pause playback:', error);
                        });
                    } else {
                        videoPlayer.play();
                        isPlaying = true;
                        playPauseBtn.textContent = '⏸';
                        playbackInterval = setInterval(updatePlaybackTime, 1000);
                        
                        // If time-shifting is active, resume properly
                        window.api.resumePlayback().catch(error => {
                            console.error('Failed to resume playback:', error);
                        });
                    }
                }
                
                function stopPlayer() {
                    if (!currentChannel) return;
                    
                    videoPlayer.pause();
                    isPlaying = false;
                    playPauseBtn.textContent = '⏵';
                    clearInterval(playbackInterval);
                    
                    if (hls) {
                        hls.destroy();
                        hls = null;
                    }
                    
                    videoPlayer.removeAttribute('src');
                    videoPlayer.load();
                    
                    // Reset UI
                    playbackTime = 0;
                    timeDisplay.textContent = formatTime(playbackTime);
                    progressFilled.style.width = '0%';
                    
                    // Reset channel info
                    currentChannel = null;
                    channelName.textContent = 'No Channel Selected';
                    channelGroup.textContent = '';
                    channelLogo.style.display = 'none';
                    statusChannel.textContent = 'No channel selected';
                    statusQuality.textContent = '';
                    
                    window.api.stopPlayback();
                }
                
                function toggleRecording() {
                    if (!currentChannel) return;
                    
                    if (!isRecording) {
                        // Start recording
                        window.api.startRecording(currentChannel.id)
                            .then(result => {
                                isRecording = true;
                                recordBtn.textContent = '⏹';
                                recordBtn.style.color = '#ff4444';
                                statusRecording.style.display = 'block';
                            })
                            .catch(error => {
                                console.error('Error starting recording:', error);
                                alert(`Failed to start recording: ${error.message}`);
                            });
                    } else {
                        // Stop recording
                        window.api.stopRecording()
                            .then(() => {
                                isRecording = false;
                                recordBtn.textContent = '⚫';
                                recordBtn.style.color = '#ffffff';
                                statusRecording.style.display = 'none';
                            })
                            .catch(error => {
                                console.error('Error stopping recording:', error);
                                alert(`Failed to stop recording: ${error.message}`);
                            });
                    }
                }
                  function toggleMute() {
                    isMuted = !isMuted;
                    videoPlayer.muted = isMuted;
                    muteBtn.textContent = isMuted ? '🔇' : '🔊';
                }
                
                function seekBackward(seconds) {
                    if (!currentChannel) return;
                    
                    // Call the API function to seek backward in the time-shift buffer
                    window.api.seekBackward(seconds)
                        .then(result => {
                            if (result.success) {
                                // Update UI to show we're behind live
                                if (result.behindLive) {
                                    const behindSecs = Math.round(result.behindLive);
                                    timeShiftStatus.textContent = `⏪ ${behindSecs}s behind live`;
                                    timeShiftStatus.style.display = 'inline-block';
                                    timeShiftStatus.classList.add('active');
                                }
                                // Update player position (for HLS.js)
                                if (hls && videoPlayer.duration) {
                                    // Calculate relative position in the video
                                    const seekPos = Math.max(0, videoPlayer.currentTime - seconds);
                                    videoPlayer.currentTime = seekPos;
                                }
                            }
                        })
                        .catch(error => {
                            console.error('Failed to seek backward:', error);
                        });
                }
                
                function seekForward(seconds) {
                    if (!currentChannel) return;
                    
                    // Call the API function to seek forward in the time-shift buffer
                    window.api.seekForward(seconds)
                        .then(result => {
                            if (result.success) {
                                // Update UI to show we're behind live
                                if (result.behindLive) {
                                    const behindSecs = Math.round(result.behindLive);
                                    if (behindSecs > 0) {
                                        timeShiftStatus.textContent = `⏪ ${behindSecs}s behind live`;
                                        timeShiftStatus.style.display = 'inline-block';
                                        timeShiftStatus.classList.add('active');
                                    } else {
                                        // We're at live point
                                        timeShiftStatus.textContent = 'LIVE';
                                        timeShiftStatus.style.display = 'inline-block';
                                        timeShiftStatus.classList.remove('active');
                                        setTimeout(() => {
                                            timeShiftStatus.style.display = 'none';
                                        }, 2000);
                                    }
                                }
                                // Update player position (for HLS.js)
                                if (hls && videoPlayer.duration) {
                                    // Calculate relative position in the video
                                    const seekPos = Math.min(videoPlayer.duration, videoPlayer.currentTime + seconds);
                                    videoPlayer.currentTime = seekPos;
                                }
                            } else if (result.error === 'Cannot seek beyond live point') {
                                // Show we're at live point
                                timeShiftStatus.textContent = 'LIVE';
                                timeShiftStatus.style.display = 'inline-block';
                                timeShiftStatus.classList.remove('active');
                                setTimeout(() => {
                                    timeShiftStatus.style.display = 'none';
                                }, 2000);
                            }
                        })
                        .catch(error => {
                            console.error('Failed to seek forward:', error);
                        });
                }
                
                function toggleFullscreen() {
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen();
                        document.body.classList.add('fullscreen');
                        fullscreenBtn.textContent = '⛶';
                    } else {
                        if (document.exitFullscreen) {
                            document.exitFullscreen();
                            document.body.classList.remove('fullscreen');
                            fullscreenBtn.textContent = '⛶';
                        }
                    }
                }
                
                function setupChannelGroups(channels) {
                    channelsByGroup = {};
                    
                    // Group channels by category
                    channels.forEach(channel => {
                        const group = channel.group || 'Uncategorized';
                        if (!channelsByGroup[group]) {
                            channelsByGroup[group] = [];
                        }
                        channelsByGroup[group].push(channel);
                    });
                    
                    // Sort groups
                    const sortedGroups = Object.keys(channelsByGroup).sort();
                    
                    // Clear container
                    channelGroupsContainer.innerHTML = '';
                    
                    // Create elements for each group
                    sortedGroups.forEach(groupName => {
                        const group = document.createElement('div');
                        group.className = 'channel-group';
                        
                        const header = document.createElement('div');
                        header.className = 'group-header';
                        header.textContent = `${groupName} (${channelsByGroup[groupName].length})`;
                        header.innerHTML += '<span class="group-toggle">▼</span>';
                        
                        const content = document.createElement('div');
                        content.className = 'group-content';
                        
                        // Create channel items
                        channelsByGroup[groupName].forEach(channel => {
                            const item = document.createElement('div');
                            item.className = 'channel-item';
                            item.dataset.id = channel.id;
                            
                            // Create logo if available
                            if (channel.logo) {
                                const logo = document.createElement('img');
                                logo.className = 'channel-logo';
                                logo.src = channel.logo;
                                logo.onerror = () => {
                                    logo.style.display = 'none';
                                };
                                item.appendChild(logo);
                            } else {
                                const placeholder = document.createElement('div');
                                placeholder.className = 'channel-logo';
                                item.appendChild(placeholder);
                            }
                            
                            const name = document.createElement('div');
                            name.className = 'channel-name';
                            name.textContent = channel.title;
                            item.appendChild(name);
                            
                            // Add click event to play channel
                            item.addEventListener('click', () => playChannel(channel));
                            content.appendChild(item);
                        });
                        
                        // Toggle group header
                        header.addEventListener('click', () => {
                            content.classList.toggle('open');
                            const toggle = header.querySelector('.group-toggle');
                            toggle.textContent = content.classList.contains('open') ? '▲' : '▼';
                        });
                        
                        group.appendChild(header);
                        group.appendChild(content);
                        channelGroupsContainer.appendChild(group);
                        
                        // Open first group by default
                        if (sortedGroups.length === 1) {
                            content.classList.add('open');
                            header.querySelector('.group-toggle').textContent = '▲';
                        }
                    });
                }
                
                // Initial load
                function loadChannels() {
                    // Show loading indicator
                    channelGroupsContainer.innerHTML = '<div class="loading-channels">Loading Channels...</div>';
                    
                    console.log('UI: Requesting channels from main process');
                    window.api.getChannels()
                        .then(channels => {
                            console.log(`UI: Received ${channels.length} channels from main process`);
                            
                            // Store all channels
                            allChannels = channels;
                            
                            // Check if we have any channels
                            if (channels.length === 0) {
                                console.warn('UI: No channels received');
                                channelGroupsContainer.innerHTML = `
                                    <div class="no-channels">
                                        <h3>No Channels Found</h3>
                                        <p>This could be due to:</p>
                                        <ul>
                                            <li>No playlist sources added</li>
                                            <li>Playlist sources are unavailable</li>
                                            <li>Network connectivity issues</li>
                                        </ul>
                                        <button id="add-playlist-btn" class="action-button">Add Playlist Source</button>
                                        <button id="retry-channels-btn" class="action-button">Retry Loading</button>
                                    </div>
                                `;
                                
                                // Add event listeners for the buttons
                                document.getElementById('add-playlist-btn').addEventListener('click', () => {
                                    window.api.showAddPlaylistDialog();
                                });
                                
                                document.getElementById('retry-channels-btn').addEventListener('click', () => {
                                    loadChannels();
                                });
                            } else {
                                // Setup channel groups
                                setupChannelGroups(channels);
                            }
                        })
                        .catch(error => {
                            console.error('Error loading channels:', error);
                            channelGroupsContainer.innerHTML = `
                                <div class="channels-error">
                                    <h3>Failed to Load Channels</h3>
                                    <p>Error: ${error.message || 'Unknown error'}</p>
                                    <button id="retry-channels-btn" class="action-button">Retry</button>
                                </div>
                            `;
                            
                            // Add retry button event listener
                            document.getElementById('retry-channels-btn').addEventListener('click', () => {
                                loadChannels();
                            });
                        });
                }
                
                // Listen for playlist updates from main process
                if (window.api.onPlaylistsUpdated) {
                    window.api.onPlaylistsUpdated((result) => {
                        console.log('Playlists updated notification received:', result);
                        if (result.success) {
                            // Show notification
                            showMessage(`Playlists updated with ${result.channels} channels. Refreshing...`, 'success');
                            
                            // Reload channels after a short delay
                            setTimeout(() => {
                                loadChannels();
                            }, 1000);
                        }
                    });
                }
                
                // Start initial load
                loadChannels();
                
                function showMessage(message, type = 'info', duration = 5000) {
                    const messageContainer = document.getElementById('message-container');
                    if (!messageContainer) return;
                    
                    const messageElement = document.createElement('div');
                    messageElement.className = `message message-${type}`;
                    messageElement.textContent = message;
                    
                    messageContainer.appendChild(messageElement);
                    
                    // Add animation classes
                    setTimeout(() => {
                        messageElement.classList.add('visible');
                    }, 10);
                    
                    // Auto-remove after duration
                    setTimeout(() => {
                        messageElement.classList.remove('visible');
                        setTimeout(() => {
                            if (messageElement.parentNode === messageContainer) {
                                messageContainer.removeChild(messageElement);
                            }
                        }, 300);
                    }, duration);
                    
                    // Add close button
                    const closeBtn = document.createElement('span');
                    closeBtn.className = 'message-close';
                    closeBtn.innerHTML = '&times;';
                    closeBtn.addEventListener('click', () => {
                        messageElement.classList.remove('visible');
                        setTimeout(() => {
                            if (messageElement.parentNode === messageContainer) {
                                messageContainer.removeChild(messageElement);
                            }
                        }, 300);
                    });
                    
                    messageElement.appendChild(closeBtn);
                }
                
                // Listen for status messages from main process
                if (window.api.onStatusMessage) {
                    window.api.onStatusMessage((message) => {
                        showMessage(message.text, message.type || 'info');
                    });
                }
            } catch (error) {
                console.error('Error initializing app:', error);
            }
        });
    }); // <-- Add this closing brace to match the opening async function
    </script>
</body>
</html>